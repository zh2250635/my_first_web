const Logger = require('./logger');
const logger = new Logger('app.log');
const axios = require('axios');

 async function main(subid, mail) {
    let data = JSON.stringify({
    "answers": "[{\"questionId\":\"r0b4c249824c4438cb098191ebf8b6076\",\"answer1\":\"ZhengHui\"},{\"questionId\":\"rd08915408ef948ffb7337ceadc4b2d1d\",\"answer1\":\"Wu\"},{\"questionId\":\"r05685aa67a934452b392238cc2e15816\",\"answer1\":\"1\"},{\"questionId\":\"r2bb7914959f64bf7b72ae18025da300b\",\"answer1\":\"@subid\"},{\"questionId\":\"r50fda06f70544a209172f2dc9f97fee0\",\"answer1\":\"@mail\"},{\"questionId\":\"rf347beac51584812941f62c0db7beeec\",\"answer1\":\"tongji university\"},{\"questionId\":\"r311d31fba3ec4d26916d9e90373e60a2\",\"answer1\":\"siping road\"},{\"questionId\":\"rf6889542f5d2419ebd98f05f931bf2f4\",\"answer1\":\"shanghai\"},{\"questionId\":\"r08fe9f467f504045af9340502547d6f7\",\"answer1\":\"shanghai\"},{\"questionId\":\"r5fffab97d96c45ea9a1c0131dd2ae91d\",\"answer1\":\"200000\"},{\"questionId\":\"raabb8c154fb4461296c595383aa6d7da\",\"answer1\":\"china\"},{\"questionId\":\"r17ba4a7158be4b4b978d23a1c49f0bf0\",\"answer1\":\"https://www.tongji.edu.cn\"},{\"questionId\":\"rcb4cac63ea2a45909a5ee50b857644bd\",\"answer1\":\"021-2346329854\"},{\"questionId\":\"re4702d30b033408c95d471e3628200eb\",\"answer1\":\"Independent Service Provider (ISV)\"},{\"questionId\":\"r1481144d32b0475d9bdf297d3cd1cc51\",\"answer1\":null},{\"questionId\":\"rb58abdd5848045058d09cd78909e6635\",\"answer1\":null},{\"questionId\":\"rdd37d09e681842ae891d3cbdab03c563\",\"answer1\":\"My own organization\"},{\"questionId\":\"rc636c5941c4a40f0abdfd97bc9a77545\",\"answer1\":\"[\\\"Text and code models (Conversational AI, Search, Summarization, Writing Assistance or content generation, Code-based scenarios, Reason over Structured and Unstructured data)\\\",\\\"DALL-E 2 models (text to image)\\\",\\\"OpenAI Whisper model (Speech-to-Text)\\\",\\\"GPT-4 Turbo with Vision\\\"]\"},{\"questionId\":\"r6b1e22eb46f0496cbdc4b6a40c678418\",\"answer1\":\"[\\\"Chat and conversation interaction: Users can interact with a conversational agent that responds with information drawn from trusted documentation such as internal company documentation or tech support documentation. Conversations must be limited to answering scoped questions. Available to internal, authenticated external users, and unauthenticated external users.\\\",\\\"Code generation or transformation scenarios: Converting one programming language to another or enabling users to generate code using natural language or visual input. For example, users can take a photo of handwritten pseudocode or diagrams illustrating a coding concept and use the application to generate code based on that. Limited to internal and authenticated external users.\\\",\\\"Summarization: Users can submit content to be summarized for pre-defined topics built into the application and cannot use the application as an open-ended summarizer. Examples include summarization of internal company documentation, call center transcripts, technical reports, and product reviews. Limited to internal, authenticated external users, and unauthenticated external users.\\\",\\\"Writing assistance on specific topics: Users can create new content or rewrite content submitted by the user as a writing aid for business content or pre-defined topics. Users can only rewrite or create content for specific business purposes or pre-defined topics and cannot use the application as a general content creation tool for all topics. Examples of business content include proposals and reports. May not be selected to generate journalistic content (for journalistic use, select the above Journalistic content use case). Limited to internal users and authenticated external users.\\\",\\\"Search: Users can search for content in trusted source documents and files such as internal company documentation. The application does not generate results ungrounded in trusted source documentation. Limited to internal users only.\\\",\\\"Image and Video Tagging: Users can identify and tag visual elements, including objects, living beings, scenery, and actions within an image or recorded video.  Users may not attempt to use the service to identify individuals. Limited to internal users and authenticated external users.\\\",\\\"Object Detection: For use to identify the positions of individual or multiple objects in an image by providing their specific coordinates. For instance, in an image that has scattered apples, the application can identify and indicate the location of each apple. Through this application, users can obtain spatial insights regarding objects captured in images. This use case is not yet available for videos. Limited to internal users and authenticated external users.\\\",\\\"Visual Question Answering: Users can ask questions about an image or video and receive contextually relevant responses. For instance, when shown a picture of a bird, one might ask, \\\\\\\"What type of bird is this?\\\\\\\" and receive a response like, \\\\\\\"It's a European robin.\\\\\\\" The application can identify and interpret context within images and videos to answer queries. For example, if presented with an image of a crowded marketplace, users can ask, \\\\\\\"How many people are wearing hats?\\\\\\\" or \\\\\\\"What fruit is the vendor selling?\\\\\\\" and the application can provide the answers. The system may not be used to answer identifying questions about people. Limited to internal users and authenticated external users.\\\",\\\"Brand and Landmark recognition: The application can be used to identify commercial brands and popular landmarks in images or videos from a preset database of thousands of global logos and landmarks. Limited to internal users and authenticated external users.\\\"]\"},{\"questionId\":\"r0108438ad1cc4d1fb0cead6c325ac90a\",\"answer1\":\"[\\\"Accessibility Features: For use to generate imagery for visual description systems. Limited to internal users and authenticated external users.\\\",\\\"Art and Design: For use to generate imagery for artistic purposes only for designs, artistic inspiration, mood boards, or design layouts. Limited to internal and authenticated external users.\\\",\\\"Communication: For use to create imagery for business-related communication, documentation, essays, bulletins, blog posts, social media, or memos. This use case may not be selected to generate images for political campaigns or journalistic content (for journalistic use, see the Journalistic content use case below). Limited to internal and authenticated external users.\\\",\\\"Education: For use to create imagery for enhanced or interactive learning materials, either for use in educational institutions or for professional training. Limited to internal users and authenticated external users.\\\",\\\"Entertainment: For use to create imagery to enhance entertainment content such as video games, movies, TV, videos, recorded music, podcasts, audio books, or augmented or virtual reality. This use case may not be selected to generate images for political campaigns or journalistic content (for journalistic use, see the below Journalistic content use case). Limited to internal and authenticated external users.\\\",\\\"Journalistic content: For use to create imagery to enhance journalistic content. May not be used to generate images for political campaigns. Limited to internal users.\\\",\\\"Marketing: For use to create marketing materials for product or service media, product introductions, business promotion, or advertisements. May not be used to create personalized or targeted advertisements to individuals. This use case may not be selected to generate images for political campaigns or journalistic content (for journalistic use, see the above Journalistic content use case). Limited to internal and authenticated external users.\\\",\\\"Prototyping and conceptual development: For use to generate imagery for ideation or visualization of products or services. This use case may not be selected to prototype use cases for DALL·E 2 that do not appear in this Question [X]. Limited to internal and authenticated external users. NOTE: Consult the Azure OpenAI Service Transparency Note for image generation best practices.\\\"]\"},{\"questionId\":\"rf4336faad6e34896b9e5f15b96143321\",\"answer1\":\"Yes, I agree\"},{\"questionId\":\"rc67af390700d462099fe51603154abfc\",\"answer1\":\"[\\\"Chat and conversation interaction: Users can interact with a conversational agent that responds with responses drawn from trusted documents such as internal company documentation or tech support documentation; conversations must be limited to answering scoped questions. Available to internal, authenticated external users, and unauthenticated external users.\\\",\\\"Chat and conversation creation: Users can create a conversational agent that responds with responses drawn from trusted documents such as internal company documentation or tech support documentation; conversations must be limited to answering scoped questions. Limited to internal users only.\\\",\\\"Code generation or transformation scenarios: For example, converting one programming language to another, generating docstrings for functions, converting natural language to SQL. Limited to internal and authenticated external users.\\\",\\\"Journalistic content: For use to create new journalistic content or to rewrite journalistic content submitted by the user as a writing aid for pre-defined topics. Users cannot use the application as a general content creation tool for all topics. May not be used to generate content for political campaigns. Limited to internal users.\\\",\\\"Question-answering: Users can ask questions and receive answers from trusted source documents such as internal company documentation. The application does not generate answers ungrounded in trusted source documentation. Available to internal, authenticated external users, and unauthenticated external users.\\\",\\\"Reason over structured and unstructured data: Users can analyze inputs using classification, sentiment analysis of text, or entity extraction. Examples include analyzing product feedback sentiment, analyzing support calls and transcripts, and refining text-based search with embeddings. Limited to internal and authenticated external users.\\\",\\\"Search: Users can search trusted source documents such as internal company documentation. The application does not generate results ungrounded in trusted source documentation. Available to internal, authenticated external users, and unauthenticated external users.\\\",\\\"Summarization: Users can submit content to be summarized for pre-defined topics built into the application and cannot use the application as an open-ended summarizer. Examples include summarization of internal company documentation, call center transcripts, technical reports, and product reviews. Limited to internal, authenticated external users, and unauthenticated external users.\\\",\\\"Writing assistance on specific topics: Users can create new content or rewrite content submitted by the user as a writing aid for business content or pre-defined topics. Users can only rewrite or create content for specific business purposes or pre-defined topics and cannot use the application as a general content creation tool for all topics. Examples of business content include proposals and reports. May not be selected to generate journalistic content (for journalistic use, select the above Journalistic content use case). Limited to internal users and authenticated external users.\\\",\\\"Data generation for fine-tuning: Users can use a model in Azure OpenAI to generate data which is used solely to fine-tune (i) another Azure OpenAI model, using the fine-tuning capabilities of Azure OpenAI, and/or (ii) another Azure AI custom model, using the fine-tuning capabilities of the Azure AI service. Generating data and fine-tuning models is limited to internal users only; the fine-tuned model may only be used for inferencing in the applicable Azure AI service and, for Azure OpenAI service, only for customer’s permitted use case(s) under this form.\\\"]\"},{\"questionId\":\"recb554d6598d4a5fae809267b013956d\",\"answer1\":\"I acknowledge that these terms apply to use of the Azure OpenAI Service\"},{\"questionId\":\"ra01be5546c2c4b3bae6eea768c3a2bfc\",\"answer1\":\"Yes, I attest (except if and to the extent I am approved for and configure my application for modified content filtering and/or abuse detection)\"},{\"questionId\":\"r8a05f2931bc94f5aaa4d2444a1328ae3\",\"answer1\":null}]"
    });

    data = data.replace('@subid', subid).replace('@mail', mail)

    let config = {
    method: 'post',
    maxBodyLength: Infinity,
    url: 'https://customervoice.microsoft.com/formapi/api/72f988bf-86f1-41af-91ab-2d7cd011db47/groups/08d8a7b7-e6ac-4a9c-b6ca-3f3f3e1bd7fc/forms(\'v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso_Pz4b1_xUNTZBNzRKNlVQSFhZMU9aV09EVzYxWFdORCQlQCN0PWcu\')/responses',
    headers: { 
        'authority': 'customervoice.microsoft.com', 
        'accept': 'application/json', 
        'accept-language': 'zh-CN,zh;q=0.9', 
        'content-type': 'application/json', 
        'odata-maxversion': '4.0', 
        'odata-version': '4.0', 
        'origin': 'https://customervoice.microsoft.com', 
        'referer': 'https://customervoice.microsoft.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR7en2Ais5pxKtso_Pz4b1_xUNTZBNzRKNlVQSFhZMU9aV09EVzYxWFdORCQlQCN0PWcu', 
        'sec-ch-ua': '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"', 
        'sec-ch-ua-mobile': '?0', 
        'sec-ch-ua-platform': '"Windows"', 
        'sec-fetch-dest': 'empty', 
        'sec-fetch-mode': 'cors', 
        'sec-fetch-site': 'same-origin', 
        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36', 
        'x-ms-form-request-ring': 'formspro', 
        'x-ms-form-request-source': 'ms-formweb'
    },
    data : data
    };

    // logger.info(data)
    // logger.info(typeof data)
    // logger.info(JSON.stringify(config))

    axios.request(config)
    .then((response) => {
        logger.info(JSON.stringify(response.data));
    })
    .catch((error) => {
        logger.error(error);
    });
}

/**
 * 应用预览函数，用于对指定的 subids 进行预览操作。
 * @param {Array} subids - 需要进行预览操作的 subids 数组。
 * @param {string} mail - 邮箱地址，默认为 '1314@zhtec.xyz'。
 * @returns {boolean} - 预览操作是否成功的布尔值。
 */
async function apply_preview(subids, mail = '1314@zhtec.xyz'){
    for(let i = 0; i < subids.length; i++){
        await main(subids[i], mail)
    }
    return true
}

if (module === require.main) {
    (async () => {
        await apply_preview(['82b58a7e-242b-4b43-b05f-75a8d7632ad5', 'cdf06386-2fda-41ea-bded-1ab0769887d9','cdf06386-2fda-41ea-bded-1ab0769887d9'])
    })();
}

module.exports = {
    apply_preview
}
